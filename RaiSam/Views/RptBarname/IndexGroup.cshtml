@model RaiSam.Models.RptBarname
@using Ext.Net.MVC
@using Hogaf.ExtNet.UX
@using Ext.Net;
@{
    var X = Html.X();
}
<style>
    .custom-icon {
        margin-right: 380px !important;
    }

    .grid-title {
        text-align: right;
    }
</style>
<script>
    Ext.net.FilterHeader.behaviour.string[0].match = function (recordValue, matchValue) {
        return (Ext.net.FilterHeader.behaviour.getStrValue(recordValue) || "").indexOf(matchValue) > -1;
    };

    Ext.net.FilterHeader.behaviour.string[0].getStrValue = function (value) {
        return value.toString();
    };

    Ext.net.FilterHeader.behaviour.string[0].serialize = function (value) {
        return {
            type: "string",
            op: "*",
            value: value
        };
    };

</script>

@(Html.X().Panel()
    .Closable(true)
    .AutoScroll(true)
        .Border(false)
    .CloseAction(CloseAction.Destroy)
                    .Listeners(li =>
                    {
                        li.AfterRender.Handler = "setSizeRptPanel()";
                        li.Render.Fn = "addKeyMapRptGroup";
                    })
        //  .Listeners(l => l.AfterRender.Handler = "setTitlePnlRpt()")
       .Layout(LayoutType.Fit).Title("گزارش گروهی بارنامه ها")
                .ID("RptGroup")
    .Items(
        X.Panel()
            .AutoScroll(true)
            .Border(false)
            .Layout(LayoutType.VBox)
            .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
            .Items(
                X.FieldSet().Border(false)//.Width(760)
            .Items(
                        X.Panel()
                    .AutoScroll(true)
                    .Border(false)
                    .ButtonAlign(Alignment.Center)
                    .Buttons(
             Html.X().Button()
        .Text("خروجی")
        .ItemID("btnxls")
        .Icon(Ext.Net.Icon.Page)
                .Listeners(l => l.Click.Handler = "XlsBarname()"),
                                       
                                        
                                            
                                    //     Html.X().Button()
                                    //.Text("مرحله قبل")
                                    //.ItemID("btnpre")
                                    //.Icon(Ext.Net.Icon.ArrowRight)
                                    //            .Listeners(l => l.Click.Handler = "PrevBarname()"),
                                    //         Html.X().Button()
                                    //    .Text("مرحله بعد")
                                    //    .ItemID("btnnxt")
                                    //    .Icon(Ext.Net.Icon.ArrowLeft)
                                    //            .Listeners(l => l.Click.Handler = "NextBarname()"),
                             X.SplitButton()
                                                .Text("راهنما")
                                                .Icon(Ext.Net.Icon.Help)
                                                .Menu(X.Menu()
                                                .Items(
                                                X.MenuItem()
                                                            .Text("راهنما متنی")
                                                            .Icon(Ext.Net.Icon.TextPaddingTop)
                                                                        .Listeners(l => l.Click.Handler = "HelpBarname()"),
                                                    X.MenuItem()
                                                            .Text("راهنما تصویری")
                                                            .Icon(Ext.Net.Icon.PlayBlue)
                                                                        .Listeners(l => l.Click.Handler = "showHelp_VideoBarname()")

                                            )
                                            ),
                        Html.X().Button()
                            .Text("خروج")
                            .ItemID("btnOut")
                            .Icon(Ext.Net.Icon.DoorOut)
                                        .Listeners(l => l.Click.Handler = " App.RptGroup.destroy()")
                            )
                    .Items(
                                X.FieldSet().MarginSpec("5px 0 0 0")//.Width(680)
                                .ItemID("Filters")
                                .Border(true).Title("فیلترها")
                                .Defaults(new { Margin = 2 })
                               .Layout(Ext.Net.LayoutType.VBox)
                    .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                            .Items(
                                    X.Hidden().ItemID("fldMalek_InfoGridId"),
                                            X.Hidden().ItemID("fldContractGridId"),
                                X.Hidden().ItemID("fldVagonGridId"),

                                 X.FieldSet().MarginSpec("5px 0 0 0")//.Width(680)
                                .Border(false)
                                .Defaults(new { Margin = 2 })
                            .Layout(LayoutType.Table)
                            .LayoutConfig(new TableLayoutConfig { Columns = 8 })
                            .Items(
                                X.Label("نوع واگن:"),
                                        X.ComboBox()
          .Width(100)
                                            .ItemID("CboTypeVagon")
                                            .Editable(false)
                                            .ForceSelection(true)
                                            .AutoFocus(true)
        // .TypeAhead(true)
                                            .AllowBlank(false)
                                            .BlankText("لطفا نوع واگن را انتخاب کنید.")
                                                    .Listeners(l => l.Select.Handler = "ChangeTypeVagon()")
                                            .QueryMode(DataLoadMode.Local)
                                            .TriggerAction(TriggerAction.All)
                                                   .Items(
                                    new ListItem("مسافری", "1"),
                                    new ListItem("باری", "3")
                                    )
                                .SelectedItems(new { Value = "3" })
                                ,

                                   X.Label("گزارش براساس:"),
                                    X.ComboBox()
          .Width(100)
                                        .ItemID("CboTypeRPT")
                                        .Editable(false)
                                        .ForceSelection(true)
                                        .AutoFocus(true)
        // .TypeAhead(true)
                                        .AllowBlank(false)
                                        .BlankText("لطفا نوع گزارش گیری را انتخاب کنید.")
                                                .Listeners(l => l.Change.Handler = "ChangeTypeRPT()")
                                        .QueryMode(DataLoadMode.Local)
                                        .TriggerAction(TriggerAction.All)
                                        .Items(
                                            new ListItem("مالک", "0"),
                                                new ListItem("پروژه", "1"),
                                                    new ListItem("شماره واگن", "2"),
                                                        new ListItem("واگن تا واگن", "3"),
                                                        new ListItem("لیست واگن", "4")
                                                ),
                                        X.Label("از سال:"),
                                            X.ComboBox()
                                        .LabelAlign(Ext.Net.LabelAlign.Top)
                                            .ItemID("CboAzYear")
                                                .Width(70)
                                        .DisplayField("fldYear")
                                        .ValueField("fldYear")
                                        .TypeAhead(true)
                                        .Editable(false)
                                        .AllowBlank(false)
                                        .BlankText("لطفا سال را انتخاب کنید.")
                                        .QueryMode(DataLoadMode.Local)
                                            .ForceSelection(true)
                                                            .Listeners(l => l.Select.Handler = "SelectAzSalTaSal()")
                                        .TriggerAction(TriggerAction.All)
                                                .Store(X.Store()
                                                .Listeners(l => l.Load.Handler = "SetDefultYear();")
                                        .Model(X.Model()
                                        .IDProperty("fldYear")
                                            .Fields(
                                                new ModelField("fldYear", ModelFieldType.String) { Mapping = "fldYear" }
                                            )
                                        )
                                            .Proxy(X.AjaxProxy()
                                            .Url(Url.Action("GetSal"))
                                            .Reader(X.JsonReader().Root("data"))
                                                    )
                                        )
                                              ,
                                                  X.Label("تا سال:"),
                                                X.ComboBox()
                                            .LabelAlign(Ext.Net.LabelAlign.Top)
                                                .ItemID("CboTaYear")
                                                    .Width(70)
                                            .DisplayField("fldYear")
                                            .ValueField("fldYear")
                                            .TypeAhead(true)
                                            .Editable(false)
                                            .AllowBlank(false)
                                            .BlankText("لطفا سال را انتخاب کنید.")
                                            .QueryMode(DataLoadMode.Local)
                                                .ForceSelection(true)
                                                                .Listeners(l => l.Select.Handler = "SelectAzSalTaSal()")
                                            .TriggerAction(TriggerAction.All)
                                                    .Store(X.Store()
                                                    .Listeners(l => l.Load.Handler = "SetDefultTaYear();")
                                            .Model(X.Model()
                                            .IDProperty("fldYear")
                                                .Fields(
                                                    new ModelField("fldYear", ModelFieldType.String) { Mapping = "fldYear" }
                                                )
                                            )
                                                .Proxy(X.AjaxProxy()
                                                .Url(Url.Action("GetSal"))
                                                .Reader(X.JsonReader().Root("data"))
                                                        )
                                            )     
                                    
                                       
                                             ,
                                        X.Label("از واگن:").ItemID("lblAzShVagon"),
                                        X.TextField()
        //.Width(100)
                                             .ItemID("txtAzShVagon")
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا شماره واگن ابتدا را انتخاب کنید.")
        //.Width(118)
                                    .MaxLength(7).MaskRe("[ 0-9]")
                                    .EnforceMaxLength(true),
                                        X.Label("تا واگن:").ItemID("lblTaShVagon"),
                                        X.TextField()
        //    .Width(100)
                                             .ItemID("txtTaShVagon")
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا شماره واگن انتها را انتخاب کنید.")
        //.Width(118)
                                    .MaxLength(7).MaskRe("[ 0-9]")
                                    .EnforceMaxLength(true)
        /* ,
          X.FieldSet()
 .Border(false)
 .Layout(LayoutType.Table)
 .LayoutConfig(new TableLayoutConfig { Columns = 2 })
 .Defaults(new { Margin = 2 })
 .Items(
   X.Checkbox().ItemID("CheckZero").RTL(false),
     X.Label("نمایش مقادیر صفر")
 )*/
                                        )
                                   ,
                                X.GridPanel()
                                          .Height(350)
                                          .PaddingSpec("10px 0 10px 0")
                                .Cls("grid-title")
                        .AutoScroll(true)
                        .Border(true)
                        .Title("مالکان")
                        .ItemID("GridSearchMalek")
                        .Store(
                                    X.StoreFor(Model.Malek)
          .Listeners(l => l.Load.Handler = "LoadSelectedMalek()")
                                .Proxy(Html.X().AjaxProxy()
                                        .Url(Url.Action("ReadMalek"))
                                        .Reader(Html.X().JsonReader().Root("data"))
        // .ExtraParams(x => x.Add(new { MalekId = @ViewBag.MalekId }))
                            )
                            .PageSize(20000)
                            .RemoteFilter(false)
                            .RemotePaging(false)
                        )
                        .View(
                            Html.X().GridView().LoadingText("در حال بارگذاری...").RTL(true)
                        )
                        .Plugins(X.FilterHeader().Remote(false))
                        .ColumnModel(
                                     Html.X().Column().DataIndex(Model.Malek, m => m.fldId).Text("کد").Flex(1).Hidden(true),
                                        Html.X().Column().DataIndex(Model.Malek, m => m.fldNameCompany).Text("نام مالک").Wrap(true).Flex(7),
                                        Html.X().Column().DataIndex(Model.Malek, m => m.fldCodeEghtasadi).Text("کداقتصادی").Wrap(true).Flex(3),
                                        Html.X().Column().DataIndex(Model.Malek, m => m.fldShenaseMeli).Text("شناسه ملی").Wrap(true).Flex(3),
                                        Html.X().Column().DataIndex(Model.Malek, m => m.fldTypeSamaneName).Text("نوع سامانه").Flex(3)
                        )
                        .SelectionModel(
                            Html.X().CheckboxSelectionModel().CheckOnly(true)
                                .PruneRemoved(false)
                                .Mode(Ext.Net.SelectionMode.Multi)
                        )
                                .Width(650).ColSpan(6)
               ,
                                      X.GridPanel()
                                          .Height(350)
                                              .PaddingSpec("10px 0 10px 0")
                                    .Cls("grid-title")
                        .AutoScroll(true)
                        .Border(true)
                        .Title("پروژه ها")
                        .ItemID("GridSearchContract")
                        .Store(
                                X.StoreFor(Model.Contract)
                                .AutoLoad(false)
        //.Listeners(l => l.Load.Handler = "GetCheckedData()")
                                .Proxy(Html.X().AjaxProxy()
                                            .Url(Url.Action("ReadContract"))
                                        .Reader(Html.X().JsonReader().Root("data"))
                                                .ExtraParams(x => x.Add(new { Malek = @ViewBag.Malek }))
                            )
                            .PageSize(20000)
                            .RemoteFilter(false)
                            .RemotePaging(false)
                        )
                        .View(
                            Html.X().GridView().LoadingText("در حال بارگذاری...").RTL(true)
                        )
                        .Plugins(X.FilterHeader().Remote(false))
                             .Plugins(
                                                                X.RowExpander()
                                                                                .Listeners(l => l.BeforeExpand.Fn = "loadGridVagonsDetail")
                                                                    .Component(
                                                                        X.GridPanel()
                                                                            .AutoScroll(true)
                                                                            .ForceFit(true)
                                                                            .Border(true)
                                                                            .Height(150)
                                                                                                .ItemID("GridVagonsDetail")
        //.Listeners(l => l.ItemMouseEnter.Fn = "createTooltipMasirInDetailsKilometrazh2")
                                                                            .Store(
                                                                                        X.StoreFor(Model.Detail)
                                                                                    .AutoLoad(false)
                                                                                    .Proxy(Html.X().AjaxProxy()
                                                                                                    .Url(Url.Action("ReadVagonsDetail"))
                                                                                        .Reader(Html.X().JsonReader().Root("data"))
                                                                                )
                                                                                .PageSize(10)
                                                                                .RemoteFilter(true)
                                                                                .RemotePaging(true)
                                                                            )
                                                                                .ViewConfig(
                                                                                    X.GridView()
                                                                                            .LoadingText("در حال بارگذاری...").RTL(true)
                                    .GetRowClass(l => l.Fn = "getRowClassInProj")
                                                                                )
                                                                            .ColumnModel(
                                                                                 Html.X().RowNumbererColumn(),
                                                                                                            Html.X().Column().DataIndex(Model.Detail, m => m.fldHeaderId).Text("fldHeaderId").Hidden(true).Flex(1),
                                                                                                                    Html.X().Column().DataIndex(Model.Detail, m => m.Ismalk).Text("Ismalk").Hidden(true).Flex(1),
                                                                             Html.X().Column().DataIndex(Model.Detail, m => m.fldNameMalek).Text("مالک واگن").Wrap(true).Flex(7),
                                                                                                                                                                Html.X().Column().DataIndex(Model.Detail, m => m.fldShomareVagon).Text("شماره واگن").Wrap(true).Flex(3),
                                                                                                        Html.X().Column().DataIndex(Model.Detail, m => m.fldZarfiyatBargiri).Text("ظرفیت واگن").Wrap(true).Flex(3),
                                                                                                        Html.X().Column().DataIndex(Model.Detail, m => m.fldTypeVagon).Text("نوع واگن").Wrap(true).Flex(3),
                                                                                                            Html.X().Column().DataIndex(Model.Detail, m => m.fldKarbariVagonName).Text("کاربری واگن").Wrap(true).Flex(3)
                                                                            )
                                                                            .SelectionModel(
                                                                                Html.X().RowSelectionModel()
                                                                                    .Mode(Ext.Net.SelectionMode.Single)
                                                                            )
                                                                    )
                                                            )
                        .ColumnModel(
                                          Html.X().Column().DataIndex(Model.Contract, m => m.fldId).Text("کد").Hidden(true).Flex(1),
                                        Html.X().Column().DataIndex(Model.Contract, m => m.fldTitle).Text("عنوان").Wrap(true).Flex(7),
                                        Html.X().Column().DataIndex(Model.Contract, m => m.fldNameCompany).Text("نام شرکت").Wrap(true).Flex(7),
                                        Html.X().Column().DataIndex(Model.Contract, m => m.fldShomareContract).Text("شماره قرارداد").Wrap(true).Flex(3),
                                        Html.X().Column().DataIndex(Model.Contract, m => m.fldTarikhContract).Text("تاریخ قرارداد").Wrap(true).Flex(3),
                                        Html.X().Column().DataIndex(Model.Contract, m => m.fldShomareMovafeghat).Text("شماره موافقتنامه").Wrap(true).Flex(3),
                                            Html.X().Column().DataIndex(Model.Contract, m => m.fldTarikhMovafeghat).Text("تاریخ موافقتنامه").Wrap(true).Flex(3),
                                                Html.X().Column().DataIndex(Model.Contract, m => m.fldTedadVagon).Text("تعداد واگن").Wrap(true).Flex(2)
                        )
        //  .Listeners(a => a.CellDblClick.Handler = "NextSearchContract();")
                        .SelectionModel(
                            Html.X().CheckboxSelectionModel().CheckOnly(true)
        //.Listeners(l =>
        //{
        //    l.Deselect.Fn = "getDeselectData";
        //})
                                .PruneRemoved(false)
                                .Mode(Ext.Net.SelectionMode.Multi)
                        )

                                .Width(650).ColSpan(6)
                                ,
                                        X.GridPanel()
                                        .Height(350)
                                            .Title("واگن ها")
                                              .PaddingSpec("10px 0 10px 0")
                                    .Cls("grid-title")
                        .AutoScroll(true)
                        .Border(true)

                        .ItemID("GridSearchVagon")
                        .Store(
                                X.StoreFor(Model.vagon)
                            .AutoLoad(false)
        //.Listeners(l => l.Load.Handler = "GetCheckedData()")
                                .Proxy(Html.X().AjaxProxy()
                                        .Url(Url.Action("ReadVagon"))
                                        .Reader(Html.X().JsonReader().Root("data"))
                                                            .ExtraParams(x => x.Add(new { Proj = @ViewBag.Proj }))
                            )
                            .PageSize(20000)
                            .RemoteFilter(true)
                            .RemotePaging(false)
                        )
                        .View(
                            Html.X().GridView().LoadingText("در حال بارگذاری...").RTL(true)
                        )
                            .Plugins(X.FilterHeader().Remote(true))
                        .ColumnModel(
                                             Html.X().Column().DataIndex(Model.vagon, m => m.fldId).Text("کد").Hidden(true).Flex(1),
                                                Html.X().Column().DataIndex(Model.vagon, m => m.fldShomareVagon).Text("شماره واگن").Wrap(true).Flex(3),
                                                Html.X().Column().DataIndex(Model.vagon, m => m.fldKarbariVagonName).Text("کاربری واگن").Wrap(true).Flex(3),
                                                Html.X().Column().DataIndex(Model.vagon, m => m.fldNameCompany).Text("مالک واگن").Wrap(true).Flex(4),
                                                Html.X().Column().DataIndex(Model.vagon, m => m.fldToolVagon).Text("طول واگن").Wrap(true).Flex(3),
                                                Html.X().Column().DataIndex(Model.vagon, m => m.fldTypeVagon).Text("توع واگن").Wrap(true).Flex(3),
                                                    Html.X().Column().DataIndex(Model.vagon, m => m.fldVaznKhali).Text("وزن واگن").Wrap(true).Flex(3),
                                                        Html.X().Column().DataIndex(Model.vagon, m => m.fldZarfiyatBargiri).Text("ظرفیت").Wrap(true).Flex(3)
                        )
                        .SelectionModel(
                            Html.X().CheckboxSelectionModel().CheckOnly(true)
                                .PruneRemoved(false)
                                .Mode(Ext.Net.SelectionMode.Multi)
                        )
                              .Width(650).ColSpan(6)

                                ,
                                    X.FormPanel()
                                     .Layout(LayoutType.Table)
                                     .Border(false)
                                .LayoutConfig(new TableLayoutConfig { Columns = 2 })
                                    .ColSpan(6).Width(650)
                                .ItemID("flsFile").Items(
                                X.Hidden().ItemID("fldShVagon"),
                                     X.FileUploadField().ItemID("btnUp")
                                .ButtonOnly(true).ButtonText("آپلود فایل اکسل")
                                .PaddingSpec("0 29px 0 0")
                                .DirectEvents(l =>
                                {
                                    l.Change.Action = "UploadExcelFileVagon";
                                    l.Change.Success = "hideprogressExcelFileVagon();";
                                })
                                    .Listeners(l => l.Change.Fn = "showFileExcelVagon")
                                .Icon(Ext.Net.Icon.DiskUpload)
                                ,
                                X.Label().ItemID("lblXlsVagon")
                                )
                        )
                        )
                        )
        /*,
    Html.X().Panel()
    .Border(true)
            .Listeners(L => L.AfterRender.Handler = "setSizeRptPanel()")
    .AutoScroll(true)
        .ItemID("RptPanel2_KarkardD")*/
            )

    )

)
<script type="text/javascript">
  
    function ChangeTypeVagon() {
        App.RptGroup.queryById('GridSearchVagon').getSelectionModel().clearSelections();
        App.RptGroup.queryById('GridSearchContract').getSelectionModel().clearSelections();

        var fldContractGridId = App.RptGroup.queryById('fldContractGridId');
        var CboTypeVagon = App.RptGroup.queryById('CboTypeVagon');
        var CboAzYear = App.RptGroup.queryById('CboAzYear');
        var CboTaYear = App.RptGroup.queryById('CboTaYear');
       

        var AzTa  = CboAzYear.getValue() + "/01"  + "/01";
        var TaTa = CboTaYear.getValue() + "/12" + "/30";
        

        var fldMalek_InfoGridId = App.RptGroup.queryById('fldMalek_InfoGridId').getValue();
        App.RptGroup.queryById('GridSearchContract').getStore().getProxy().setExtraParam("TypeVagon", CboTypeVagon.getValue());
        App.RptGroup.queryById('GridSearchContract').getStore().getProxy().setExtraParam("MalekId", fldMalek_InfoGridId);
        App.RptGroup.queryById('GridSearchContract').store.load();

        App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("TypeVagon", CboTypeVagon.getValue());
        App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("Projj", fldContractGridId.getValue());
        App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("azTarikh", AzTa);
        App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("tatarikh", TaTa);
        App.RptGroup.queryById('GridSearchVagon').store.load();
    }
    function LoadSelectedMalek() {
        if ('@ViewBag.IsMalek' == 1)
        App.RptGroup.queryById('GridSearchMalek').getSelectionModel().selectAll();
    }
    var loadGridVagonsDetail = function (rowExpanderr, record) {
       

        var CboAzYear = App.RptGroup.queryById('CboAzYear');
        var CboTaYear = App.RptGroup.queryById('CboTaYear');

        var AzTa = CboAzYear.getValue() + "/01" + "/01";
        var TaTa = CboTaYear.getValue() + "/12" + "/30";

        rowExpanderr.component.getStore().getProxy().setExtraParam("fldHeaderId", record.data.fldId);
        rowExpanderr.component.getStore().getProxy().setExtraParam("azTarikh", AzTa);
        rowExpanderr.component.getStore().getProxy().setExtraParam("tatarikh", TaTa);

        rowExpanderr.component.getStore().load();
    };
    var getRowClassInProj = function (record, rowIndex, rowParams, store) {
        if (record.data.Ismalk == 0) {
            return "YellowRow";
        }
    };

    function showHelp_VideoBarname() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/RptBarname/VideoWinBarname',
            success: function (data) {
                Ext.net.Mask.hide();
            }
        });

    }
    function HelpBarname() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/RptBarname/HelpBarname',
            success: function (data) {
                Ext.net.Mask.hide();
            }
        });
    }
    function SetDefultYear() {
        var CboAzYear = App.RptGroup.queryById('CboAzYear');
        CboAzYear.setValue('@ViewBag.AzSal');
    }
    function SetDefultTaYear() {
        var CboTaYear = App.RptGroup.queryById('CboTaYear');
        CboTaYear.setValue('@ViewBag.AzSal');
    }
   
    function NextBarname() {
        var fldMalek_InfoGridId = App.RptGroup.queryById('fldMalek_InfoGridId');
        var fldContractGridId = App.RptGroup.queryById('fldContractGridId');
        var fldVagonGridId = App.RptGroup.queryById('fldVagonGridId');
        var CboAzYear = App.RptGroup.queryById('CboAzYear');
        var CboTaYear = App.RptGroup.queryById('CboTaYear');

        

        var btnpre = App.RptGroup.queryById('btnpre');
        var btnnxt = App.RptGroup.queryById('btnnxt');
        var CboTypeRPT = App.RptGroup.queryById('CboTypeRPT');
        var GridSearchMalek = App.RptGroup.queryById('GridSearchMalek');
        var GridSearchContract = App.RptGroup.queryById('GridSearchContract');
        var GridSearchVagon = App.RptGroup.queryById('GridSearchVagon');
        if (CboTypeRPT.getValue() == "0") {
            if (GridSearchMalek.isHidden() == false) {
                var SelectedRow1 = App.RptGroup.queryById('GridSearchMalek').getSelectionModel().getSelection();
                var Malekan = "";
                for (var i = 0; i < SelectedRow1.length; i++)
                    Malekan = Malekan + SelectedRow1[i].data.fldId + ",";
                fldMalek_InfoGridId.setValue(Malekan);

                if (Malekan == "") {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب حداقل یک مالک ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                } 
                if (CboAzYear.getValue() = "" || CboAzYear.getValue() == null) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب سال ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }
                if (CboTaYear.getValue() = "" || CboTaYear.getValue() == null) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب سال ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }

                GridSearchContract.show();
                GridSearchMalek.hide();
                btnpre.show();
                btnnxt.show();

                App.RptGroup.queryById('GridSearchContract').getStore().getProxy().setExtraParam("TypeVagon", CboTypeVagon.getValue());
                App.RptGroup.queryById('GridSearchContract').getStore().getProxy().setExtraParam("MalekId", Malekan);
                App.RptGroup.queryById('GridSearchContract').store.load();

            }
            else if (GridSearchContract.isHidden() == false) {
                var SelectedRow2 = App.RptGroup.queryById('GridSearchContract').getSelectionModel().getSelection();
                var Proj = "";
                for (var i = 0; i < SelectedRow2.length; i++)
                    Proj = Proj + SelectedRow2[i].data.fldId + ",";
                fldContractGridId.setValue(Proj);

                if (Proj == "") {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب حداقل یک پروژه ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }
                if (CboAzYear.getValue() = "" || CboAzYear.getValue() == null) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب سال ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }
                if (CboTaYear.getValue() = "" || CboTaYear.getValue() == null) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب سال ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }

                GridSearchVagon.show();
                GridSearchContract.hide();
                btnpre.show();
                btnnxt.hide();

                var AzTa = CboAzYear.getValue() + "/01" + "/01";
                var TaTa = CboTaYear.getValue() + "/12" + "/30";

                App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("TypeVagon", CboTypeVagon.getValue());
                App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("Projj", Proj);
                App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("azTarikh", AzTa);
                App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("tatarikh", TaTa);
                App.RptGroup.queryById('GridSearchVagon').store.load();
            }
        }
        else if (CboTypeRPT.getValue() == "1") {
            if (GridSearchContract.isHidden() == false) {

                var SelectedRow2 = App.RptGroup.queryById('GridSearchContract').getSelectionModel().getSelection();
                var Proj = "";
                for (var i = 0; i < SelectedRow2.length; i++)
                    Proj = Proj + SelectedRow2[i].data.fldId + ",";
                fldContractGridId.setValue(Proj);

                if (Proj == "") {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب حداقل یک پروژه ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }
                if (CboAzYear.getValue() = "" || CboAzYear.getValue() == null) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب سال ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }
                if (CboTaYear.getValue() = "" || CboTaYear.getValue() == null) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب سال ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }

                GridSearchVagon.show();
                GridSearchContract.hide();
                btnpre.show();
                btnnxt.hide();


                var AzTa = CboAzYear.getValue() + "/01" + "/01";
                var TaTa = CboTaYear.getValue() + "/12" + "/30";

                App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("TypeVagon", CboTypeVagon.getValue());
                App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("Projj", Proj);
                App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("azTarikh", AzTa);
                App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("tatarikh", TaTa);
                App.RptGroup.queryById('GridSearchVagon').store.load();
            }
        }
        CboTypeRPT.setReadOnly(true);
    }
    function PrevBarname() {
        var CboTypeRPT = App.RptGroup.queryById('CboTypeRPT');
        var GridSearchMalek = App.RptGroup.queryById('GridSearchMalek');
        var GridSearchContract = App.RptGroup.queryById('GridSearchContract');
        var GridSearchVagon = App.RptGroup.queryById('GridSearchVagon');
        var btnpre = App.RptGroup.queryById('btnpre');

        if (CboTypeRPT.getValue() == "0") {
            if (GridSearchVagon.isHidden() == false) {
                GridSearchContract.show();
                GridSearchVagon.hide();
                btnpre.show();
            }
            else if (GridSearchContract.isHidden() == false) {
                GridSearchMalek.show();
                GridSearchContract.hide();
                btnpre.hide();
                CboTypeRPT.setReadOnly(false);
            }
        }
        if (CboTypeRPT.getValue() == "1") {
            if (GridSearchVagon.isHidden() == false) {
                GridSearchContract.show();
                GridSearchVagon.hide();
                btnpre.hide();
                CboTypeRPT.setReadOnly(false);
            }
        }
    }
    function ChangeTypeRPT() {    /*GridSearchVagon    GridSearchContract   GridSearchMalek*/

        var CboTypeRPT = App.RptGroup.queryById('CboTypeRPT');
        var GridSearchMalek = App.RptGroup.queryById('GridSearchMalek');
        var GridSearchContract = App.RptGroup.queryById('GridSearchContract');
        var GridSearchVagon = App.RptGroup.queryById('GridSearchVagon');
        var lblAzShVagon = App.RptGroup.queryById('lblAzShVagon');
        var txtAzShVagon = App.RptGroup.queryById('txtAzShVagon');
        var lblTaShVagon = App.RptGroup.queryById('lblTaShVagon');
        var txtTaShVagon = App.RptGroup.queryById('txtTaShVagon');
        var flsFile = App.RptGroup.queryById('flsFile');
       /* var btnnxt = App.RptGroup.queryById('btnnxt');*/
        var CboTypeVagon = App.RptGroup.queryById('CboTypeVagon');
        var CboAzYear = App.RptGroup.queryById('CboAzYear');
        var CboTaYear = App.RptGroup.queryById('CboTaYear');
        var AzTa = CboAzYear.getValue() + "/01" + "/01";
        var TaTa = CboTaYear.getValue() + "/12" + "/30";

        ClearAll();

        if (CboTypeRPT.getValue() == "0") {
            GridSearchMalek.show();
            GridSearchContract.hide();
            GridSearchVagon.hide();
            lblAzShVagon.hide();
            txtAzShVagon.hide();
            lblTaShVagon.hide();
            txtTaShVagon.hide();
            flsFile.hide();
           /* btnnxt.show();*/
            App.RptGroup.queryById('Filters').setSize(App.ReportRaiSamWin.getWidth() - 200, App.ReportRaiSamWin.getHeight() - 180);
        }
        else if (CboTypeRPT.getValue() == "1") {
            GridSearchMalek.hide();
            GridSearchContract.show();
            GridSearchVagon.hide();
            lblAzShVagon.hide();
            txtAzShVagon.hide();
            lblTaShVagon.hide();
            txtTaShVagon.hide();
            flsFile.hide();
            /*btnnxt.show();*/
            App.RptGroup.queryById('Filters').setSize(App.ReportRaiSamWin.getWidth() - 200, App.ReportRaiSamWin.getHeight() - 180);

            App.RptGroup.queryById('GridSearchContract').getStore().getProxy().setExtraParam("TypeVagon", CboTypeVagon.getValue());
            App.RptGroup.queryById('GridSearchContract').getStore().getProxy().setExtraParam("MalekId", "");
            App.RptGroup.queryById('GridSearchContract').store.load();
        }
        else if (CboTypeRPT.getValue() == "2") {
            GridSearchMalek.hide();
            GridSearchContract.hide();
            GridSearchVagon.show();
            lblAzShVagon.hide();
            txtAzShVagon.hide();
            lblTaShVagon.hide();
            txtTaShVagon.hide();
            flsFile.hide();
           /* btnnxt.hide();*/
            App.RptGroup.queryById('Filters').setSize(App.ReportRaiSamWin.getWidth() - 200, App.ReportRaiSamWin.getHeight() - 180);

            App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("TypeVagon", CboTypeVagon.getValue());
            App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("Projj", "");
            App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("azTarikh", AzTa);
            App.RptGroup.queryById('GridSearchVagon').getStore().getProxy().setExtraParam("tatarikh", TaTa);
            App.RptGroup.queryById('GridSearchVagon').store.load();
        }
        else if (CboTypeRPT.getValue() == "3") {
            GridSearchMalek.hide();
            GridSearchContract.hide();
            GridSearchVagon.hide();
            lblAzShVagon.show();
            txtAzShVagon.show();
            lblTaShVagon.show();
            txtTaShVagon.show();
            flsFile.hide();
            /*btnnxt.hide();*/
            App.RptGroup.queryById('Filters').setSize(App.ReportRaiSamWin.getWidth() - 200, 100);
        }
        else if (CboTypeRPT.getValue() == "4") {
            GridSearchMalek.hide();
            GridSearchContract.hide();
            GridSearchVagon.hide();
            lblAzShVagon.hide();
            txtAzShVagon.hide();
            lblTaShVagon.hide();
            txtTaShVagon.hide();
            flsFile.show();
           /* btnnxt.hide();*/
            App.RptGroup.queryById('Filters').setSize(App.ReportRaiSamWin.getWidth() - 200, 100);
        }
    }
    function HelpBarname() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/ReportsMachinery/HelpBarname',
            success: function (data) {
                Ext.net.Mask.hide();
            }
        });
    }

    function searchMalek(Code) {
        if (Code == 45) {
            App.RptGroup.body.mask("در حال بارگذاری");
            Ext.net.DirectMethod.request({
                url: '/SearchMalek_Vagon/IndexChecked',
                params: {
                    State: 1,
                },
                success: function () {
                    App.RptGroup.body.mask().hide();
                }
            });
        }
    }
    function SearchContract_Project(Code) {
        if (Code == 45) {
            App.RptGroup.body.mask("در حال بارگذاری");
            Ext.net.DirectMethod.request({
                url: '/SearchContract_Project/IndexChecked',
                params: {
                    State: 1,
                    Malek: App.RptGroup.queryById('fldMalek_InfoId').getValue()
                },
                success: function () {
                    App.RptGroup.body.mask().hide();
                }
            });
        }
    }

   
    function SelectAzSalTaSal() {
        var CboTypeVagon = App.RptGroup.queryById('CboTypeVagon');
        var fldMalek_InfoGridId = App.RptGroup.queryById('fldMalek_InfoGridId').getValue();
        if (fldMalek_InfoGridId != "" && fldMalek_InfoGridId != null) {
            App.RptGroup.queryById('GridSearchContract').getStore().getProxy().setExtraParam("TypeVagon", CboTypeVagon.getValue());
            App.RptGroup.queryById('GridSearchContract').getStore().getProxy().setExtraParam("MalekId", fldMalek_InfoGridId);
            App.RptGroup.queryById('GridSearchContract').store.load();
        }
    }

    function setSizeRptPanel() {

        App.RptGroup.queryById('CboTypeRPT').setValue("0");
        var DateStart = new Date('@ViewBag.fldTarikh');
      

       /* App.RptGroup.queryById('btnpre').hide();*/


        App.RptGroup.queryById('Filters').setSize(App.ReportRaiSamWin.getWidth() - 200, App.ReportRaiSamWin.getHeight() - 180);
        App.RptGroup.queryById('GridSearchVagon').setSize(App.ReportRaiSamWin.getWidth() - 230, App.ReportRaiSamWin.getHeight() - 230);
        App.RptGroup.queryById('GridSearchContract').setSize(App.ReportRaiSamWin.getWidth() - 230, App.ReportRaiSamWin.getHeight() - 230);
        App.RptGroup.queryById('GridSearchMalek').setSize(App.ReportRaiSamWin.getWidth() - 230, App.ReportRaiSamWin.getHeight() - 230);

    }


    function PrintBarname() {
        var CboTypeVagon = App.RptGroup.queryById('CboTypeVagon');
        if (CboTypeVagon.getValue() == "2") {
            Ext.MessageBox.show({
                title: "خطا",
                msg: "انجام این عملیات فعلا امکان پذیر نمی باشد.",
                icon: Ext.MessageBox.ERROR,
                buttons: Ext.MessageBox.OK
            });
        }
        else
            GenerateBarname(1);
    }
    function XlsBarname() {
        GenerateBarname(2);
    }

    function GenerateBarname(st) {

        var CboTypeRPT = App.RptGroup.queryById('CboTypeRPT');
        var lblAzShVagon = App.RptGroup.queryById('lblAzShVagon');
        var txtAzShVagon = App.RptGroup.queryById('txtAzShVagon');
        var lblTaShVagon = App.RptGroup.queryById('lblTaShVagon');
        var txtTaShVagon = App.RptGroup.queryById('txtTaShVagon');
        var fldShVagon = App.RptGroup.queryById('fldShVagon');
        var lblXlsVagon = App.RptGroup.queryById('lblXlsVagon');
        var fldShVagon = App.RptGroup.queryById('fldShVagon');
        var CboTypeVagon = App.RptGroup.queryById('CboTypeVagon');

        var GridSearchMalek = App.RptGroup.queryById('GridSearchMalek');
        var GridSearchContract = App.RptGroup.queryById('GridSearchContract');
        var GridSearchVagon = App.RptGroup.queryById('GridSearchVagon');
        var fldMalek_InfoGridId = App.RptGroup.queryById('fldMalek_InfoGridId');
        var fldContractGridId = App.RptGroup.queryById('fldContractGridId');
        var fldVagonGridId = App.RptGroup.queryById('fldVagonGridId');

        var CboAzYear = App.RptGroup.queryById('CboAzYear');
        var CboTaYear = App.RptGroup.queryById('CboTaYear');

      
        var AzTa = CboAzYear.getValue() + "/01" + "/01";
        var TaTa = CboTaYear.getValue() + "/12" + "/30";

        var height = App.ReportRaiSamWin.getHeight() - 225;

        var MalekId = ""; var ContractId = ""; var ShVagon = ""; var AzVagon = ""; var TaVagon = "";

        if ( CboAzYear.validate() == true ) {

            if (CboTypeRPT.getValue() == "0") {
                if (GridSearchMalek.isHidden() == false) {
                    var SelectedRow1 = App.RptGroup.queryById('GridSearchMalek').getSelectionModel().getSelection();
                    for (var i = 0; i < SelectedRow1.length; i++)
                        MalekId = MalekId + SelectedRow1[i].data.fldId + ",";

                    ContractId = "";
                }
                else if (GridSearchContract.isHidden() == false) {
                    var SelectedRow1 = App.RptGroup.queryById('GridSearchContract').getSelectionModel().getSelection();
                    for (var i = 0; i < SelectedRow1.length; i++)
                        ContractId = ContractId + SelectedRow1[i].data.fldId + ",";

                    MalekId = fldMalek_InfoGridId.getValue();
                }
                else if (GridSearchVagon.isHidden() == false) {
                    var SelectedRow1 = App.RptGroup.queryById('GridSearchVagon').getSelectionModel().getSelection();
                    for (var i = 0; i < SelectedRow1.length; i++)
                        ShVagon = ShVagon + SelectedRow1[i].data.fldShomareVagon + ",";

                    MalekId = fldMalek_InfoGridId.getValue();
                    ContractId = fldContractGridId.getValue();
                }

                if (MalekId == "") {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب حداقل یک مالک ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }
            }
            else if (CboTypeRPT.getValue() == "1") {
                if (GridSearchContract.isHidden() == false) {
                    var SelectedRow1 = App.RptGroup.queryById('GridSearchContract').getSelectionModel().getSelection();
                    for (var i = 0; i < SelectedRow1.length; i++)
                        ContractId = ContractId + SelectedRow1[i].data.fldId + ",";

                }
                else if (GridSearchVagon.isHidden() == false) {
                    var SelectedRow1 = App.RptGroup.queryById('GridSearchVagon').getSelectionModel().getSelection();
                    for (var i = 0; i < SelectedRow1.length; i++)
                        ShVagon = ShVagon + SelectedRow1[i].data.fldShomareVagon + ",";

                    ContractId = fldContractGridId.getValue();
                }

                if (ContractId == "") {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب حداقل یک پروژه ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }
            }
            else if (CboTypeRPT.getValue() == "2") {
                var SelectedRow1 = App.RptGroup.queryById('GridSearchVagon').getSelectionModel().getSelection();
                for (var i = 0; i < SelectedRow1.length; i++)
                    ShVagon = ShVagon + SelectedRow1[i].data.fldShomareVagon + ",";

                if (ShVagon == "") {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "انتخاب حداقل یک واگن ضروری است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }
            }
            else if (CboTypeRPT.getValue() == "3") {
                if (txtAzShVagon.validate() == true && txtTaShVagon.validate() == true) {
                    AzVagon = txtAzShVagon.getValue();
                    TaVagon = txtTaShVagon.getValue();
                }
                else
                    return;
            }
            else if (CboTypeRPT.getValue() == "4") {
                if (fldShVagon.getValue() != "") {
                    ShVagon = fldShVagon.getValue();
                }
                else
                    return;
            }

            if (st == 1) {
          
            }
            else if (st == 2) {
               Ext.net.Mask.show({ msg: ' در حال بارگذاری....' });
                /*   $.ajax({
                    type: "POST",
                    dataType: 'native',
                    url: "/RptBarname/GenerateXlsGroup",
                    xhrFields: {
                        responseType: 'blob'
                    },
                    data: {
                            sal: CboAzYear.getValue(),
                            Tasal: CboTaYear.getValue(),
                        MalekId:MalekId,
                        ContractId:ContractId,
                        ShVagon:ShVagon,
                        AzVagon:AzVagon,
                        TaVagon:TaVagon,
                        TypeVagon:CboTypeVagon.getValue(),
                        State:0,
                        CheckZero:false
                    },
                    success: function (blob) {
                        x = blob;
                        var link = document.createElement('a');
                        link.href = window.URL.createObjectURL(blob);
                        link.download = "AllFile" + CboAzYear.getValue() + "_" + CboTaYear.getValue() + ".xls";
                        link.click();
                        Ext.net.Mask.hide();
                    },
                    timeout: 7200000
                });*/
                Ext.net.DirectMethod.request({
                    url: '/RptBarname/CheckedWin',
                    params: {
                        sal: CboAzYear.getValue(),
                        Tasal: CboTaYear.getValue(),
                        MalekId: MalekId,
                        ContractId: ContractId,
                        ShVagon: ShVagon,
                        AzVagon: AzVagon,
                        TaVagon: TaVagon,
                        TypeVagon: CboTypeVagon.getValue(),
                        State: 0
                    },
                    success: function (data) {
                        Ext.net.Mask.hide();
                    }
                });
              
            }
         

        }
        else {
            return;
        }
    }

    var MojazExcelFileVagon = 0;
    var EndUploadExcelFileVagon = false;

    var CheckExcelFileVagon = setInterval(CheckEndExcelFileVagon, 500);

    function CheckEndExcelFileVagon() {
        if (EndUploadExcelFileVagon == true) {
            Ext.MessageBox.hide();
            clearInterval(CheckEndExcelFileVagon);
            EndUploadExcelFileVagon = false;
            Ext.net.Mask.show({ msg: 'فایل با موفقیت آپلود شد. در حال بارگذاری....' });
            Ext.net.DirectMethod.request({
                url: '/RptBarname/ProcessXlsVagon',
                success: function (data) {
                    var ic = Ext.MessageBox.INFO;
                    if (data.Er == 1) {
                        App.RptGroup.queryById('lblXlsVagon').setText("هیچ شماره واگنی دریافت نشد.");

                    }
                    else {
                        App.RptGroup.queryById('lblXlsVagon').setText("واگن های موردنظر با موفقیت بارگذاری شد.");
                        App.RptGroup.queryById('fldShVagon').setValue(data.VagonIds);
                    }
                    Ext.net.Mask.hide();
                },
                timeout: 90000
            });
        }
    }

    var showFileExcelVagon = function (fb, v) {
        if (v) {
            showProgressBarExcelFileVagon();
            if (v.split('.').pop().toLowerCase() == "xls" || v.split('.').pop().toLowerCase() == "xlsx") {
                MojazExcelFileVagon = 1;
            }
        }
    };

    function hideprogressExcelFileVagon() {
        if (MojazExcelFileVagon == 1) {
            EndUploadExcelFileVagon = true;
        }
        MojazExcelFileVagon = 0;
    }

    function showProgressBarExcelFileVagon() {
        Ext.MessageBox.show({
            msg: 'لطفاً منتظر باشید',
            progressText: 'در حال آپلود فایل...',
            width: 300,
            wait: true,
            waitConfig:
            {
                interval: 200,
                text: 'در حال آپلود فایل...',
                scope: this
            }
        });
    }
    function ClearAll() {
        App.RptGroup.queryById('txtAzShVagon').setValue("");
        App.RptGroup.queryById('txtTaShVagon').setValue("");
        App.RptGroup.queryById('fldShVagon').setValue("");
    }
    var addKeyMapRptGroup = function (cmp) {
        var CboTypeRPT = App.RptGroup.queryById('CboTypeRPT');
        var CboTypeBaze = App.RptGroup.queryById('CboTypeBaze');

        this.keyMap = new Ext.util.KeyMap({
            target: cmp.getEl(),
            binding: [{
                key: [13, 9], /*Ext.EventObject.ENTER,*/
                fn: function (key, e) {
                    if (e.getKey() == 9) {
                        e.stopEvent();
                    }
                    var keyfield = App.RptGroup.queryById(Ext.getCmp((Ext.Element.getActiveElement()).name).itemId);
                    var nextfld;

                    if (keyfield.itemId == "CboTypeBaze") {
                        if (CboTypeBaze.getValue() == "0")
                            nextfld = App.RptGroup.queryById('txtAzTarikh');
                        else if (CboTypeRPT.getValue() == "1") {
                            nextfld = App.RptGroup.queryById('CboAzMonth');
                        }
                    }
                    if (keyfield.itemId == "txtTaTarikh") {
                        if (CboTypeRPT.getValue() == "0")
                            nextfld = App.RptGroup.queryById('btnPrint');
                        else if (CboTypeRPT.getValue() == "1")
                            nextfld = App.RptGroup.queryById('btnPrint');
                        else if (CboTypeRPT.getValue() == "2")
                            nextfld = App.RptGroup.queryById('btnPrint');
                        else if (CboTypeRPT.getValue() == "3")
                            nextfld = App.RptGroup.queryById('txtAzShVagon');
                        else if (CboTypeRPT.getValue() == "4")
                            nextfld = App.RptGroup.queryById('btnUp');
                    }
                    if (keyfield.itemId == "CboTaYear") {
                        if (CboTypeRPT.getValue() == "0")
                            nextfld = App.RptGroup.queryById('btnPrint');
                        else if (CboTypeRPT.getValue() == "1")
                            nextfld = App.RptGroup.queryById('btnPrint');
                        else if (CboTypeRPT.getValue() == "2")
                            nextfld = App.RptGroup.queryById('btnPrint');
                        else if (CboTypeRPT.getValue() == "3")
                            nextfld = App.RptGroup.queryById('txtAzShVagon');
                        else if (CboTypeRPT.getValue() == "4")
                            nextfld = App.RptGroup.queryById('btnUp');
                    }
                    else {
                        nextfld = keyfield.nextSibling().nextSibling();
                    }
                    nextfld.focus();
                    nextfld.selectText();
                }
            }]
        });
    }
</script>

